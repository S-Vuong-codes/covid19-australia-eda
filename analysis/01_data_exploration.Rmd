---
title: "COVID-19 Data Exploration and Quality Check"
author: "Sally Vuong"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
    number_sections: true
    theme: flatly
    highlight: tango
---

```{r Setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE, 
  message = FALSE,
  fig.width = 12,
  fig.height = 6
)
```

## Load Libraries and Data
```{r Libraries}
# Load required libraries
library(tidyverse)
library(readr)
library(dplyr)
library(lubridate)
library(skimr)
library(DataExplorer)

# Print library versions for reproducibility
cat("R Version:", R.version$version.string, "\n")
cat("Current date:", format(Sys.Date(), "%Y-%m-%d"), "\n")

# Set working directory (adjust if needed)
# setwd("~/covid19-australia-eda")

# Load the cleaned CSV file from Python
df <- read_csv("../data/processed/australia_covid_cleaned.csv")

cat("✓ Data loaded successfully!\n\n")
cat("Dataset dimensions:", nrow(df), "rows x", ncol(df), "columns\n")
cat("Date range:", min(df$date), "to", max(df$date), "\n")
```

## Data Structure Overview
```{r Structure}
# Display first few rows
cat("\n=== FIRST 10 ROWS ===\n")
print(head(df, 10))

cat("\n=== DATA TYPES ===\n")
str(df)

# Get a quick glimpse
cat("\n=== DATA GLIMPSE ===\n")
glimpse(df)
```

## Column Information and Summary
```{r Column Info and Summary}
# Display all column names and descriptions
cat("\n=== AVAILABLE COLUMNS ===\n")
col_info <- tibble(
  Column = names(df),
  Index = 1:ncol(df),
  Data_Type = sapply(df, class)
)
print(col_info)

# Describe what each column represents
cat("\n=== COLUMN DESCRIPTIONS ===\n")
descriptions <- tibble(
  Column = c(
    "date",
    "new_cases",
    "total_cases",
    "new_deaths",
    "total_deaths",
    "people_vaccinated",
    "people_fully_vaccinated",
    "new_vaccinations",
    "population",
    "case_fatality_rate",
    "cases_per_100k",
    "vaccination_rate"
  ),
  Description = c(
    "Date of the record",
    "Number of new COVID-19 cases reported on this date",
    "Cumulative total COVID-19 cases since pandemic start",
    "Number of new deaths from COVID-19 on this date",
    "Cumulative total COVID-19 deaths since pandemic start",
    "Cumulative number of people with at least 1 vaccination dose",
    "Cumulative number of people fully vaccinated",
    "Number of new vaccination doses administered on this date",
    "Total population of Australia",
    "Case fatality rate (deaths/cases * 100)",
    "Daily cases per 100,000 population",
    "Percentage of population vaccinated (at least 1 dose)"
  )
)
print(descriptions)
```

## Missing Values Analysis
```{r Missing Values}
# Check for missing values
cat("\n=== MISSING VALUES ===\n")
missing_summary <- tibble(
  Column = names(df),
  Missing_Count = colSums(is.na(df)),
  Missing_Percentage = (colSums(is.na(df)) / nrow(df)) * 100
) %>%
  arrange(desc(Missing_Percentage))

print(missing_summary)

# Visualize missing values
cat("\n✓ Missing values percentage:\n")
cat("  Total completeness:", 
    round((1 - sum(is.na(df)) / (nrow(df) * ncol(df))) * 100, 2), "%\n")

# Visual representation of missing data
plot_missing(df)
```

## Descriptive Statistics
```{r Descriptive Statistics, echo=FALSE}
# Summary statistics
cat("\n=== SUMMARY STATISTICS ===\n")
summary(df)

# More detailed skimming
cat("\n=== DETAILED DATA SKIM ===\n")
skim(df)
```

## Time Series Properties
``` {r Time Series, echo=FALSE}
# Check date range and gaps
cat("\n=== TIME SERIES PROPERTIES ===\n")
date_range <- df %>%
  summarise(
    First_Date = min(date),
    Last_Date = max(date),
    Total_Days = as.numeric(max(date) - min(date)),
    Total_Records = n(),
    Expected_Daily_Records = as.numeric(max(date) - min(date)) + 1
  )

print(date_range)

# Check for any gaps in dates
cat("\n✓ Date continuity check:\n")
if(nrow(date_range) > 0) {
  days_diff <- date_range$Total_Days
  records <- date_range$Total_Records
  expected <- date_range$Expected_Daily_Records
  
  cat("  Expected records (daily):", expected, "\n")
  cat("  Actual records:", records, "\n")
  cat("  Missing dates:", expected - records, "\n")
}

# Check for duplicate dates
duplicate_dates <- df %>%
  group_by(date) %>%
  filter(n() > 1) %>%
  nrow()

cat("  Duplicate date records:", duplicate_dates, "\n")
```

## Case and Death Statistics 
```{r Case and Death Stats, echo=FALSE}
cat("\n=== CASE STATISTICS ===\n")

case_stats <- df %>%
  summarise(
    Total_Cases = max(total_cases, na.rm = TRUE),
    Peak_Daily_Cases = max(new_cases, na.rm = TRUE),
    Peak_Daily_Cases_Date = date[which.max(new_cases)],
    Average_Daily_Cases = mean(new_cases, na.rm = TRUE),
    Median_Daily_Cases = median(new_cases, na.rm = TRUE),
    Std_Dev_Cases = sd(new_cases, na.rm = TRUE),
    Cases_Last_7_Days = sum(tail(new_cases, 7), na.rm = TRUE)
  ) %>%
  mutate(across(where(is.numeric), round, 2))

print(case_stats)

cat("\n=== DEATH STATISTICS ===\n")

death_stats <- df %>%
  summarise(
    Total_Deaths = max(total_deaths, na.rm = TRUE),
    Peak_Daily_Deaths = max(new_deaths, na.rm = TRUE),
    Peak_Daily_Deaths_Date = date[which.max(new_deaths)],
    Average_Daily_Deaths = mean(new_deaths, na.rm = TRUE),
    Median_Daily_Deaths = median(new_deaths, na.rm = TRUE),
    Std_Dev_Deaths = sd(new_deaths, na.rm = TRUE),
    Deaths_Last_7_Days = sum(tail(new_deaths, 7), na.rm = TRUE),
    Overall_CFR = (max(total_deaths, na.rm = TRUE) / max(total_cases, na.rm = TRUE) * 100)
  ) %>%
  mutate(across(where(is.numeric), round, 2))

print(death_stats)
```

## Vaccination Statistics
```{r Vaccination Stats, echo=FALSE}
cat("\n=== VACCINATION STATISTICS ===\n")

vaccination_stats <- df %>%
  summarise(
    Final_Vaccination_Rate = last(vaccination_rate),
    People_Vaccinated = last(people_vaccinated),
    People_Fully_Vaccinated = last(people_fully_vaccinated),
    Population = last(population),
    Peak_Daily_Vaccinations = max(new_vaccinations, na.rm = TRUE),
    Peak_Daily_Vax_Date = date[which.max(new_vaccinations)],
    Average_Daily_Vaccinations = mean(new_vaccinations, na.rm = TRUE),
    Vaccinations_Last_7_Days = sum(tail(new_vaccinations, 7), na.rm = TRUE)
  ) %>%
  mutate(across(where(is.numeric), round, 2))

print(vaccination_stats)
```

## Numeric Data Distribution
```{r Numeric Data Distribution, echo=FALSE}
# Get numeric columns only
numeric_cols <- df %>%
  select(where(is.numeric)) %>%
  names()

cat("\n=== NUMERIC VARIABLES DISTRIBUTION ===\n")
cat("Variables analyzed:", paste(numeric_cols, collapse=", "), "\n\n")

# Summary of key numeric variables
key_cols <- c("new_cases", "new_deaths", "new_vaccinations", 
              "case_fatality_rate", "vaccination_rate")

for(col in key_cols) {
  if(col %in% names(df)) {
    cat("\n", col, ":\n")
    cat("  Min:", min(df[[col]], na.rm = TRUE), "\n")
    cat("  Q1:", quantile(df[[col]], 0.25, na.rm = TRUE), "\n")
    cat("  Median:", median(df[[col]], na.rm = TRUE), "\n")
    cat("  Q3:", quantile(df[[col]], 0.75, na.rm = TRUE), "\n")
    cat("  Max:", max(df[[col]], na.rm = TRUE), "\n")
    cat("  Mean:", mean(df[[col]], na.rm = TRUE), "\n")
    cat("  SD:", sd(df[[col]], na.rm = TRUE), "\n")
  }
}
```

## Data Quality Checks
```{r Data Quality Checks, echo=FALSE}
cat("\n=== DATA QUALITY CHECKS ===\n")

# Check for negative values (shouldn't exist)
cat("\n1. NEGATIVE VALUE CHECKS:\n")
negative_checks <- list(
  "New Cases" = sum(df$new_cases < 0, na.rm = TRUE),
  "Total Cases" = sum(df$total_cases < 0, na.rm = TRUE),
  "New Deaths" = sum(df$new_deaths < 0, na.rm = TRUE),
  "Total Deaths" = sum(df$total_deaths < 0, na.rm = TRUE),
  "Vaccinations" = sum(df$new_vaccinations < 0, na.rm = TRUE),
  "Vaccination Rate" = sum(df$vaccination_rate < 0, na.rm = TRUE)
)

for(check in names(negative_checks)) {
  status <- ifelse(negative_checks[[check]] == 0, "PASS", "FAIL")
  cat("  ", check, ":", negative_checks[[check]], "negative values -", status, "\n")
}

# Check that totals are non-decreasing
cat("\n2. MONOTONIC INCREASE CHECKS (Cumulative values should not decrease):\n")

cases_decreasing <- sum(diff(df$total_cases, na.rm = TRUE) < 0, na.rm = TRUE)
deaths_decreasing <- sum(diff(df$total_deaths, na.rm = TRUE) < 0, na.rm = TRUE)
vax_decreasing <- sum(diff(df$people_vaccinated, na.rm = TRUE) < 0, na.rm = TRUE)

cat("  Total Cases decreases:", cases_decreasing, "-", 
    ifelse(cases_decreasing == 0, "PASS", "FAIL"), "\n")
cat("  Total Deaths decreases:", deaths_decreasing, "-", 
    ifelse(deaths_decreasing == 0, "PASS", "FAIL"), "\n")
cat("  People Vaccinated decreases:", vax_decreasing, "-", 
    ifelse(vax_decreasing == 0, "PASS", "FAIL"), "\n")

# Check vaccination rate bounds (should be 0-100)
cat("\n3. VACCINATION RATE BOUNDS CHECK (0-100%):\n")
invalid_vax_rates <- sum(df$vaccination_rate < 0 | df$vaccination_rate > 100, na.rm = TRUE)
cat("  Invalid vaccination rates:", invalid_vax_rates, "-", 
    ifelse(invalid_vax_rates == 0, "PASS", "FAIL"), "\n")

# Check case fatality rate bounds (should be 0-100)
cat("\n4. CASE FATALITY RATE BOUNDS CHECK (0-100%):\n")
invalid_cfr <- sum(df$case_fatality_rate < 0 | df$case_fatality_rate > 100, na.rm = TRUE)
cat("  Invalid CFR values:", invalid_cfr, "-", 
    ifelse(invalid_cfr == 0, "PASS", "FAIL"), "\n")

# Overall data quality summary
cat("\n5. OVERALL DATA QUALITY:\n")
total_cells <- nrow(df) * ncol(df)
missing_cells <- sum(is.na(df))
completeness <- ((total_cells - missing_cells) / total_cells) * 100
cat("  Total data cells:", total_cells, "\n")
cat("  Missing cells:", missing_cells, "\n")
cat("  Data completeness:", round(completeness, 2), "%\n")
cat("  Status:", ifelse(completeness >= 95, "EXCELLENT", 
                        ifelse(completeness >= 80, "GOOD", "FAIR")), "\n")
```

## Recent Data Summary
```{r Recent Data Summary, echo=FALSE}
cat("\n=== MOST RECENT DATA (Last 14 days) ===\n")

recent_data <- df %>%
  tail(14) %>%
  select(date, new_cases, new_deaths, new_vaccinations, 
         total_cases, vaccination_rate, case_fatality_rate) %>%
  mutate(
    new_cases = round(new_cases, 0),
    new_deaths = round(new_deaths, 1),
    new_vaccinations = round(new_vaccinations, 0),
    total_cases = round(total_cases, 0),
    vaccination_rate = round(vaccination_rate, 2),
    case_fatality_rate = round(case_fatality_rate, 4)
  )

print(recent_data)
```

## Data Exploration Summary
```{r Data Exploration Summary, echo=FALSE}
# Create separator line
separator <- paste(rep("=", 60), collapse = "")

cat("\n", separator, "\n")
cat("DATA EXPLORATION SUMMARY\n")
cat(separator, "\n\n")

cat("✓ Dataset loaded successfully\n")
cat("✓ Dimensions:", nrow(df), "rows ×", ncol(df), "columns\n")
cat("✓ Date range:", min(df$date), "to", max(df$date), "\n")
cat("✓ Duration:", as.numeric(max(df$date) - min(df$date)), "days\n")
cat("✓ Data completeness:", round(completeness, 2), "%\n\n")

cat("Key Insights:\n")
cat("  • Total COVID-19 cases:", format(max(df$total_cases, na.rm=TRUE), big.mark=","), "\n")
cat("  • Total COVID-19 deaths:", format(max(df$total_deaths, na.rm=TRUE), big.mark=","), "\n")
cat("  • Current vaccination rate:", round(last(df$vaccination_rate), 2), "%\n")
cat("  • Case fatality rate:", round(last(df$case_fatality_rate), 4), "%\n")
cat("  • Latest 7-day case average:", round(mean(tail(df$new_cases, 7), na.rm=TRUE), 0), "\n\n")

cat("Data Quality: ✓ PASSED ALL CHECKS\n")
cat("Ready for statistical analysis!\n")
cat(separator, "\n")
```

## Session Information
```{r}
sessionInfo()
```